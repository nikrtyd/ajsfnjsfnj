<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Задача 9</title>
  <!-- <link href="https://allfont.ru/allfont.css?fonts=schoolbook" rel="stylesheet" type="text/css" /> -->
  <!-- STYLE -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap');

    :root {
      --body-background: #114;
      --body-foreground: #eee;
      --body-background-locked: #225;
      --body-foreground-locked: #ddd;
      --button-background: #336;
      --button-background-active: #225;
      --button-border: #ccc;
      --table-border: #99f;
      --input-border: #aaf;
      --system-before: #ccc2;
      --label: #66a;
      --good: #6f80ef;
      --bad: #6c70df;
      --border-radius: 20px;
    }

    body,
    main {
      margin: 0 auto;
      max-width: 1000px;
      background: var(--body-background);
      color: var(--body-foreground);
      font-family: 'Bahnschrift', 'JetBrains Mono', Geneva, Verdana, sans-serif;
      font-size: 18px;
      height: 100vh;
    }

    .flex {
      display: flex;
    }

    .ai-c {
      align-items: center;
    }

    .jc-c {
      justify-content: center;
    }

    .dir-col {
      flex-direction: column;
    }

    .ta-c {
      text-align: center;
    }

    .hide {
      display: none;
    }

    table,
    input[type=text],
    select,
    textarea {
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid #99f;
      font: inherit;
      font-family: 'JetBrains Mono';
    }

    select {
      padding: 5px;
    }

    button {
      padding: 10px 20px;
      background: #77d;
      border-radius: 20px;
      font: inherit;
      border: none;
    }

    button:active {
      background: #44a;
    }

    input,
    select,
    textarea {
      background: inherit;
      border: 2px solid var(--input-border);
      padding: 20px;
      color: inherit;
      min-height: 30px;
    }

    textarea {
      min-width: 260px;
      border-radius: 20px 20px 0 20px;
    }

    .good,
    .bad {
      font-weight: bold;
      font-size: 14px;
    }

    .good {
      color: var(--good);
    }

    .bad {
      color: var(--bad);
    }

    label {
      font-weight: bold;
      font-size: 14px;
      color: var(--button-border);
    }

    .full-wh {
      width: 100vw;
      height: 100vh;
    }

    .gap {
      gap: 20px;
    }
  </style>

</head>

<body>
  <div class="flex ai-c dir-col jc-c full-wh">
    <div class="in cont flex dir-col gap">
      <textarea name="" id="" cols="30" rows="10"></textarea>
      <button id="calc">Вычислить</button>
    </div>
    <div class="out cont flex dir-col gap">
      <canvas id="myChart"></canvas>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0/dist/chart.min.js"></script>
  <script>


    const ctx = document.getElementById('myChart').getContext('2d');
    const myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
        datasets: [{
          label: '# of Votes',
          data: [12, 19, 3, 5, 2, 3],
          backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 159, 64, 0.2)'
          ],
          borderColor: [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });


    function elem(name) {
      return document.querySelector(name);
    }
    function elems(name) {
      return document.querySelectorAll(name);
    }
    // Задаём переменные, чтобы записывать туда наши действия
    // let mainTable = elem('table'),
    //   min1 = 0,
    //   min2 = 0;

    // numbers only for all cells in table
    // for (let i = 0; i < mainTable.rows.length; i++) {
    //   for (let j = 0; j < mainTable.rows[i].cells.length; j++) {
    //     mainTable.rows[i].cells[j].onkeydown = NumbersOnly;
    //   }
    // }

    // numbers only for all inputs
    elems('input').forEach((element) => element.onkeydown = nums);

    function nums(e) {
      if (!e) e = window.event;
      var keyCode = e.keyCode || e.which;
      if (!e.ctrlKey && !e.metaKey && !e.altKey) {
        if (keyCode >= 48 && keyCode <= 57) {
          return true;
        }
        if (keyCode >= 96 && keyCode <= 105) {
          return true;
        }
        if (keyCode == 8 || keyCode == 46 || keyCode == 9 || keyCode == 45) {
          return true;
        }
        return false;
      }
    }

    // Получаем матрицу из таблицы
    function newm(t) {
      const m = [,];
      // не берем в расчет левый и верхний края таблицы, отсюда начинается матрица: i (ряд) = 2; j (столб.) = 1
      for (let i = 2; i < t.rows.length; i++) {
        let rowData = [];
        for (let j = 1; j < t.rows[i].cells.length; j++) {
          let cell = t.rows[i].cells[j];
          val(cell);
          rowData.push(parseFloat(t.rows[i].cells[j].innerText));
        }
        m[i - 2] = rowData;
      }
      return m;
    }

    // если нет данных, то присваиваем нулю
    function val(el) {
      if (!(el.innerText.match(/\d/)))
        el.innerText = 0;
    }

    function get(m) {
      min1 = 20;
      min2 = 20;
      min3 = 20;
      elem('.intt').style.visibility = 'visible';
      elem('.intt__function').innerHTML = `f(x) = ${m[0][3]}x₁ + ${m[1][3]}x₂ + ${m[2][3]}x₃ → <i>max</i>`;
      elem('.intt__restr>.system').innerHTML = `${m[0][0]}x₁ + ${m[1][0]}x₂ + ${m[2][0]}x₃ ≤ ${m[3][0]}<br>${m[0][1]}x₁ + ${m[1][1]}x₂ + ${m[2][1]}x₃ ≤ ${m[3][1]}<br>${m[0][2]}x₁ + ${m[1][2]}x₂ + ${m[2][2]}x₃ ≤ ${m[3][2]}`; // <label>, при x₁ ≥ ${min1}; x₂ ≥ ${min2}; x₃ ≥ ${min3}</label>
      let r = prof(m);
      elem('.intt__calc').innerHTML = `x₁ = ${r[1]}<label> (шт.) - кол-во изделий 1 вида</label><br>x₂ = ${r[2]}<label> (шт.) - кол-во изделий 2 вида</label><br>x₃ = ${r[3]}<label> (шт.) - кол-во изделий 3 вида</label>`;
      if (min1 * m[0][0] + min2 * m[1][0] + min3 * m[2][0] > m[3][0]) {
        elem('.intt__ver').innerHTML = `<span class="var(--bad) fs-i">ПЛАН НЕДОСТИЖИМ!!! ВАМ НУЖНО ${min1 * m[0][0] + min2 * m[1][0]} М СТАЛИ, ЧТОБЫ ЕГО ВЫПОЛНИТЬ!</span>`;
        elem('.intt__profit').innerHTML = '';
        mainTable.rows[mainTable.rows.length - 1].cells[mainTable.rows[mainTable.rows.length - 1].cells.length - 1].innerText = 'НЕДОСТИЖИМО';
        return;
      }
      elem('.intt__ver').innerHTML = `<div class="system">${m[0][0]} * ${r[1]} + ${m[1][0]} * ${r[2]} + ${m[2][0]} * ${r[3]} = ${m[0][0] * r[1] + m[1][0] * r[2] + m[2][0] * r[3]}` + (((m[0][0] * r[1] + m[1][0] * r[2]) <= m[3][0]) ? `<span class="good"> ≤ ${m[3][0]}</span>` : `<span class="bad">, больше ${m[3][0]}</span>`)
        + `<br>${m[0][1]} * ${r[1]} + ${m[1][1]} * ${r[2]} + ${m[2][1]} * ${r[3]} = ${m[0][1] * r[1] + m[1][1] * r[2] + m[2][1] * r[3]}` + (((m[0][1] * r[1] + m[1][1] * r[2] + m[2][1] * r[3]) <= m[3][1]) ? `<span class="good"> ≤ ${m[3][1]}</span>` : `<span class="bad">, больше ${m[3][1]}</span>`)
        + `<br>${m[0][2]} * ${r[1]} + ${m[1][2]} * ${r[2]} + ${m[2][2]} * ${r[3]} = ${m[0][2] * r[1] + m[1][2] * r[2] + m[2][2] * r[3]}` + (((m[0][2] * r[1] + m[1][2] * r[2] + m[2][2] * r[3]) <= m[3][2]) ? `<span class="good"> ≤ ${m[3][2]}</span>` : `<span class="bad">, больше ${m[3][2]}</span>`) + '</div>';
      elem('.intt__profit').innerHTML = `f(x) = ${m[0][3]} * ${r[1]} + ${m[1][3]} * ${r[2]} + ${m[2][3]} * ${r[3]} = ${m[0][3] * r[1] + m[1][3] * r[2] + m[2][3] * r[3]}<label> (тенге) - максимальная достижимая прибыль</label>`;
      mainTable.rows[mainTable.rows.length - 1].cells[mainTable.rows[mainTable.rows.length - 1].cells.length - 1].innerText = r[0];
    }

    function prof(m) {
      let maxProfit = 0, maxOfType1 = 0, maxOfType2 = 0, maxOfType3 = 0;
      for (let t1c = 20; t1c < 400; t1c++) {
        for (let t3c = 20; t3c < 400; t3c++) {
          for (let t2c = 20; t2c < 400; t2c++) {
            let cementSurplus = m[3][0] - (m[0][0] * t1c) - (m[1][0] * t2c) - (m[2][0] * t3c);   // остаток цемента
            let sandSurplus = m[3][1] - (m[0][1] * t1c) - (m[1][1] * t2c) - (m[2][1] * t3c);   // остаток песка
            let rubbleSurplus = m[3][2] - (m[0][2] * t1c) - (m[1][2] * t2c) - (m[2][2] * t3c);   // остаток щебня
            let newProfit = (t1c * m[0][3] + t2c * m[1][3] + t3c * m[2][3]);
            if (cementSurplus < 0 || sandSurplus < 0 || rubbleSurplus < 0) continue; // остаток не может быть меньше 0
            if (newProfit > maxProfit) {
              maxProfit = newProfit;
              maxOfType1 = t1c;
              maxOfType2 = t2c;
              maxOfType3 = t3c;
            }
          }
        }
      }
      return [maxProfit, maxOfType1, maxOfType2, maxOfType3];
    }

    // // place one sibling input-sys if there is a value in the first input-sys and no sibling input-sys
    // function placeOneSiblingInputSys(inputSys) {
    //   if (inputSys.value) {
    //     let siblingInputSys = inputSys.nextElementSibling;
    //     if (!siblingInputSys) {
    //       siblingInputSys = document.createElement('input');
    //       siblingInputSys.className = 'input-sys';
    //       siblingInputSys.type = 'number';
    //       siblingInputSys.min = 0;
    //       siblingInputSys.max = 100;
    //       siblingInputSys.step = 1;
    //       siblingInputSys.value = 0;
    //       siblingInputSys.addEventListener('input', () => placeOneSiblingInputSys(input));
    //       inputSys.parentNode.append(siblingInputSys);
    //     }
    //   }
    // }

    // elems('.input-sys').forEach(input => {
    //   input.addEventListener('input', () => {
    //     placeOneSiblingInputSys(input);
    //   });
    // });



    // remove this
    let suka =
      ["2", "5", "0", "20",
        "3", "0", "4", "40",
        "2", "2", "3", "38",
        "800", "1800", "1240"]
    let lol = 0;
    for (let rowI = 2; rowI < mainTable.rows.length; rowI++) {
      for (let cellI = 1; cellI < mainTable.rows[rowI].cells.length; cellI++) {
        elem('table').rows[rowI].cells[cellI].innerText = suka[lol];
        lol++;
      }
    }
    get(newm(mainTable));

// f(x) = 20x1 + 40x2 + 38x3 -> max
  // 2x1 + 3x2 + 2x3 <= 800
  // 5x1 + 0x2 + 2x3 <= 1800
  // 0x1 + 4x2 + 3x3 <= 1240

  </script>
</body>

</html>
